# -----------------------------------------------------------------
# CMBfast Makefile template
# used by configure to create Makefile
# -----------------------------------------------------------------

SHELL	= /bin/sh

FC	= f77
FFLAGS	= -O2
LDFLAGS	=
FITSOUT	=

dverk	= dverk.o
OBJTAB	= jlens.o jlgen.o ujlgen.o
OBJMPI  = 
OBJCMB	= cmbflat.o cmbopen.o driver.o lensing.o \
	subroutines.o params.o recfast.o $(FITSOUT) $(OBJMPI)


incfast	= cmbfast.inc
incpara	= cmbpar.inc
inclval = lvalues.inc

# JVR MOD BEGIN: adding jl.dat and jlens.dat targets in default
default: jlgen ujlgen jlens cmb jl.dat jlens.dat
# JVR MOD END

cmb: $(OBJCMB) $(dverk)
	$(FC) $(FFLAGS) -o $@ $(OBJCMB) $(dverk) $(LDFLAGS)
	#some mpi is put here in configure step

ujlgen: ujlgen.o
	$(FC) $(FFLAGS) -o $@ ujlgen.o

jlgen: jlgen.o
	$(FC) $(FFLAGS) -o $@ jlgen.o

jlens: jlens.o
	$(FC) $(FFLAGS) -o $@ jlens.o

# JVR MOD BEGIN: Defining jl.dat and jlens.dat recipes
jl.dat: jlgen
	./jlgen < jlgen_input.txt
jlens.dat: jlens
	./jlens < jlens_input.txt
# JVR MOD END

$(OBJTAB): $(incfast) $(inclval)
$(OBJCMB): $(incfast) $(incpara) $(inclval)

clean:
	-rm -f *.o
tidy: clean
	-rm -f jlgen ujlgen jlens cmb ksplit
	-rm -f Makefile Makefile.bak
	-rm -f jl.dat jlens.dat
